#!groovy

def buildVersion = "5.4.${BUILD_NUMBER}"
def commonVersion = "3.5.+"
def infraVersion = "3.5.+"

stage('checkout webcert') {
    node {
        git url: "https://github.com/sklintyg/webcert.git", branch: GIT_BRANCH
        util.run { checkout scm }
    }
}

stage('build') {
    node {
        shgradle "--refresh-dependencies clean build -DbuildVersion=${buildVersion} -DcommonVersion=${commonVersion} -DinfraVersion=${infraVersion}"
    }
}

stage('gatling') {
    node {
        try {
            sh("cd performanceTests; ../gradlew gatling -Dcertificate.baseUrl=http://webcert.inera.nordicmedtest.se")
        } finally {
            gatlingArchive()
        }
    }
}
