<div class="container-fluid" wc-authority feature="hanteraIntygsutkast">
  <div class="row">
    <div id="valj-intyg-typ" class="col-xs-12 col-lg-7 webcert-col webcert-col-single">
      <div class="row">
        <div class="col-xs-12">
        <button type="button" class="btn btn-link pull-right" ng-click="setTestMode();">
          {{current.testModeActive ? testModeText.active : testModeText.inactive}}
        </button>
        <form name="certForm" ng-submit="createDraft()" novalidate autocomplete="off">
          <!--<a class="backlink" href="#/create/choose-patient/index"><span message key="common.goback"></span></a>-->
          <h1>Sök/skriv intyg</h1>
          <div class="form-group">
            <label class="control-label">Patientuppgifter</label>
            <div class="form-group">
              <span id="patientNamn">{{fornamn}} {{mellannamn}} {{efternamn}}</span><br />
              {{personnummer}}
            </div>

            <button class="btn btn-default" type="button" ng-click="changePatient()">Byt patient</button>
          </div>

          <div class="webcert-proto-area wc-prototype-chooser-default" ng-class="{'webcert-proto-selected': prototypes.hasSelected, 'webcert-proto-unselected': !prototypes.hasSelected  }">

            <select ng-model="selectedTemplate" ng-options="t.name for t in prototypes.templates" class="proto-selector" ng-show="current.testModeActive == true" >

            </select>
            <div class="slide-animate-container">
              <div class="slide-animate" ng-include="selectedTemplate.url" onload="resetPrototype();"></div>
            </div>

          </div>

        </form>
      </div>
    </div>

    <!-- Tidigare intyg table -->
    <div class="webcert-col-section">
      <h2 class="col-head">Tidigare intyg för {{fornamn}} {{efternamn}}</h2>
      <div class="form-group" ng-if="sekretessmarkering">
        <div class="alert alert-warning col-lg-7">
          <span message key='label.copyutkast.sekretessmarkering'></span>
        </div>
        <div class="clearfix"></div>
      </div>
      <div class="form-group">
        <label class="radio-inline">
          <input id="intygFilterAktuella" name="intygFilter" type="radio" value="current"
                 ng-model="filterForm.intygFilter" checked="checked"> Aktuella intyg
        </label>
        <label class="radio-inline">
          <input id="intygFilterRattade" name="intygFilter" type="radio" value="revoked"
                 ng-model="filterForm.intygFilter" checked="checked"> Makulerade intyg
        </label>
        <label class="radio-inline">
          <input id="intygFilterSamtliga" name="intygFilter" type="radio" value="all" ng-model="filterForm.intygFilter"
                 checked="checked"> Samtliga intyg
        </label>
      </div>

      <div wc-spinner label="info.loadingdata" show-spinner="viewState.doneLoading"
           show-content="!viewState.doneLoading">
        <div class="webcert-col-section qa-table-section" id="intygLista">

          <!-- No certs for person -->
          <div id="current-list-noResults-unit"
               ng-show="!viewState.activeErrorMessageKey && viewState.currentList.length<1" class="alert alert-info">
            <span message key="info.nocertsfound"></span>
          </div>

          <!-- error message -->
          <div id="current-list-noResults-error" ng-show="viewState.activeErrorMessageKey" class="alert alert-danger">
            <span message key="{{viewState.activeErrorMessageKey}}"></span>
          </div>
          <div ng-show="viewState.inlineErrorMessageKey" class="alert alert-danger">
            <span message key="{{viewState.inlineErrorMessageKey}}"></span>
          </div>

          <!-- Previous certs table -->
          <div class="row" ng-show="viewState.currentList.length>0" id="prevCertTable">
            <table class="col-md-12 table table-striped table-qa">
              <tr>
                <th></th>
                <th></th>
                <th title="Typ av intyg.">Typ av intyg</th>
                <th title="Visar utkastets/intygets status.
- Utkast, uppgifter saknas = Utkastet är sparat, men obligatoriska uppgifter saknas.
- Utkast, kan signeras = Utkastet är sparat och kan signeras.
- Signerat = Intyget är signerat.
- Skickat = Intyget är signerat och skickat till mottagaren.
- Mottaget = Intyget är signerat och mottaget av mottagarens system.
- Makulerat = Intyget är makulerat.">Status
                </th>
                <th title="Datum då utkastet/intyget senast sparades.">Sparat datum</th>
                <th title="Person som senast sparade utkastet/intyget alternativt person som signerade intyget.">
                  Sparat/signerat av
                </th>
              </tr>
              <tr ng-repeat="cert in viewState.currentList">
                <td>
                  <button class="btn btn-info" title="Visa intyget" ng-click="openIntyg(cert)"
                          id="showBtn-{{cert.intygId}}">Visa
                  </button>
                </td>
                <td>
                  <button
                      ng-show="!sekretessmarkering && cert.status != 'CANCELLED' && cert.status != 'DRAFT_COMPLETE' && cert.status != 'DRAFT_INCOMPLETE'"
                      class="btn btn-info" wc-authority="KOPIERA_INTYG" feature="kopieraIntyg"
                      intygstyp="{{cert.intygType}}"
                      title="Skapar en kopia av befintligt intyg. Det nya intyget (kopian) kan ändras och signeras."
                      ng-click="copyIntyg(cert)" id="copyBtn-{{cert.intygId}}">
                    Kopiera
                  </button>
                </td>
                <td><span message key="certificatetypes.{{cert.intygType}}.typename"></span></td>
                <td class="unbreakable"><span message key="cert.status.{{cert.status}}"></span></td>
                <td class="unbreakable">{{cert.lastUpdatedSigned | date:'shortDate'}}</td>
                <td class="unbreakable table-qa-last">{{cert.updatedSignedBy}}</td>
              </tr>
            </table>

          </div>
          <span class="{{viewState.unsigned}}"></span>
        </div>
      </div>
      <!-- spinner end -->

    </div>
  </div>
</div></div>
